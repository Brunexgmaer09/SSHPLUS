function detectLanguage(code) {
    // Python
    if (code.includes('print(') || code.startsWith('import ') || code.includes('def ') || code.includes('class ')) return 'python';
    
    // JavaScript
    if (code.includes('console.log(') || code.includes('function ') || code.includes('const ') || code.includes('let ') || code.includes('var ')) return 'javascript';
    
    // HTML
    if (code.includes('<html>') || code.includes('<!DOCTYPE html>') || code.includes('<body>') || code.includes('<div>')) return 'html';
    
    // C++
    if (code.includes('#include') || code.includes('int main(') || code.includes('std::') || code.includes('using namespace std')) return 'cpp';
    
    // Bash
    if (code.startsWith('#!/bin/bash') || code.includes('echo ') || code.includes('fi') || code.includes('for ') || code.includes('while ')) return 'bash';
    
    // C#
    if (code.includes('using System;') || code.includes('namespace ') || code.includes('class ') || code.includes('public static void Main(')) return 'csharp';
    
    // Java
    if (code.includes('public static void main(') || code.includes('import java.') || code.includes('class ') || code.includes('System.out.println(')) return 'java';
    
    // Ruby
    if (code.includes('puts ') || code.includes('def ') || code.includes('end') || code.includes('class ')) return 'ruby';
    
    // PHP
    if (code.includes('<?php') || code.includes('echo ') || code.includes('$') || code.includes('->')) return 'php';
    
    // Swift
    if (code.includes('import Foundation') || code.includes('class ') || code.includes('func ') || code.includes('let ') || code.includes('var ')) return 'swift';
    
    // Rust
    if (code.includes('fn main(') || code.includes('let ') || code.includes('extern crate') || code.includes('use ')) return 'rust';
    
    // Go
    if (code.includes('package main') || code.includes('import ') || code.includes('func main(') || code.includes('fmt.')) return 'go';

    // TypeScript
    if (code.includes('console.log(') || code.includes('function ') || code.includes('const ') || code.includes('let ') || code.includes('var ') || code.includes('import ') || code.includes('export ')) return 'typescript';

    // SQL
    if (code.includes('SELECT ') || code.includes('FROM ') || code.includes('INSERT INTO ') || code.includes('UPDATE ') || code.includes('DELETE FROM ')) return 'sql';

    // JSON
    if (code.trim().startsWith('{') && code.trim().endsWith('}') && code.includes(':')) return 'json';

    // Markdown
    if (code.includes('# ') || code.includes('## ') || code.includes('### ') || code.includes('- ') || code.includes('* ') || code.includes('[') && code.includes('](')) return 'markdown';

    return 'plaintext'; // default
}
